<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>— Sanctuary —</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Quicksand:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-dark:#070307;
    --bg-mid:#160714;
    --accent:#be3b58;
    --glass: rgba(255,255,255,0.03);
    --muted:#c9b7bf;
  }
  html,body{height:100%;margin:0;background:
    radial-gradient(1200px 600px at 10% 10%, rgba(200,60,90,0.06), transparent 10%),
    linear-gradient(160deg,var(--bg-dark) 0%, var(--bg-mid) 60%); color:var(--muted); font-family:"Quicksand",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",sans-serif;overflow:hidden}
  /* optimized stage layout */
  .stage{height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;box-sizing:border-box}
  .card{
    width:100%;max-width:1000px;display:flex;gap:28px;border-radius:14px;padding:20px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.03);
    box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    backdrop-filter: blur(6px) saturate(.9);
    position:relative;
    will-change:transform;
    overflow:visible;
  }

  /* left art column */
  .art{width:36%;min-width:280px;display:flex;flex-direction:column;align-items:flex-start;gap:14px;position:relative}
  .rose-wrap{display:flex;flex-direction:column;gap:14px;align-items:flex-start;padding-left:6px}

  /* simple, optimized rose SVG size */
  .rose-spot{width:120px;height:120px;display:inline-block;cursor:pointer;transform-origin:center;will-change:transform}

  /* right content column */
  .content{width:64%;display:flex;flex-direction:column;justify-content:center;position:relative;padding-right:8px}
  .title{font-family:'Playfair Display',serif;color:var(--accent);font-size:30px;margin:0 0 6px}
  .subtitle{color:#c58ea0;margin:0 0 18px;font-size:13px}

  /* letter area - simpler, faster shadow and scroll */
  .letter{background:linear-gradient(180deg, rgba(0,0,0,0.12), rgba(255,255,255,0.01));border-radius:10px;padding:18px;color:#e9dfe3;line-height:1.6;font-size:15px;max-height:360px;overflow:auto;will-change:transform}
  .letter p{margin:0 0 12px;opacity:0;transform:translateY(8px);transition:opacity .28s ease, transform .28s ease}

  /* moon improved look: textured SVG + subtle glow (GPU-friendly) */
  .moon{
    position:absolute; right:22px; top:18px; width:62px; height:62px; border-radius:50%;
    display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:20;
    transform:translateZ(0);
    will-change:transform, opacity;
  }
  .moon .svg-wrap{width:86%;height:86%}
  .moon .glow{position:absolute;inset:-8px;border-radius:50%;filter:blur(12px);opacity:0.12;background:radial-gradient(circle at 40% 35%, rgba(190,60,90,0.35), rgba(60,20,40,0.02));pointer-events:none}
  .moon:hover{transform:scale(1.06)}
  .moon:active{transform:scale(0.98)}

  /* animation for moon subtle float (GPU compositing) */
  @keyframes slowFloat { 0%{transform:translateY(0)} 50%{transform:translateY(-6px)} 100%{transform:translateY(0)} }
  .moon{animation: slowFloat 5.5s ease-in-out infinite}

  /* optimized petals via CSS keyframes; less DOM work */
  .petal-wrap{position:absolute;inset:0;pointer-events:none;z-index:4;overflow:hidden}
  .petal{position:absolute;width:14px;height:18px;border-radius:50% 50% 60% 60%;background:linear-gradient(180deg, rgba(255,200,215,0.98), rgba(180,80,120,0.95));opacity:0.85;will-change:transform,opacity}
  /* each petal uses transform & opacity animation only */
  @keyframes fallA { 0%{ transform:translate3d(var(--sx,0),-12vh,0) rotate(0deg); opacity:1 } 100%{ transform:translate3d(var(--dx,0),110vh,0) rotate(720deg); opacity:0 } }

  /* cursor glow (lightweight) */
  .cursor{position:fixed;left:0;top:0;width:14px;height:14px;border-radius:50%;pointer-events:none;z-index:9999;mix-blend-mode:screen;background:radial-gradient(circle at 30% 30%, rgba(255,150,175,0.95), rgba(180,80,120,0.14) 40%);filter:blur(2px);transform:translate(-50%,-50%)}

  /* audio control small & light */
  .audio-control{position:absolute;left:18px;bottom:14px;z-index:12}
  .audio-btn{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer}

  /* secret modal (kept simple & fast) */
  .secret-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:60}
  .secret-modal.show{display:flex}
  .secret-inner{background:#0f0b0d;border-radius:12px;padding:20px;color:#f6e9ed;max-width:680px;width:92%;box-shadow:0 20px 60px rgba(0,0,0,0.6);text-align:center}

  /* responsive adjustments */
  @media (max-width:920px){
    .card{flex-direction:column;gap:16px}
    .art{order:2;width:100%;display:flex;justify-content:center}
    .content{width:100%}
    .moon{right:14px;top:10px}
  }
</style>
</head>
<body>

  <!-- small number of small petals (created in JS with CSS animations) -->
  <div class="petal-wrap" id="petalWrap" aria-hidden="true"></div>

  <div class="stage" role="main">
    <div class="card" id="card" aria-label="Secret sanctuary">
      <div class="art" aria-hidden="true">
        <div class="rose-wrap" id="roseWrap">
          <!-- fewer rose spots (lighter DOM and animations) -->
          <svg class="rose-spot" viewBox="0 0 64 64" data-quote="Remember we rode until sunrise?" role="button" tabindex="0" aria-label="Rose memory 1">
            <defs><linearGradient id="rg1" x1="0" x2="1"><stop offset="0" stop-color="#ff9bb4"/><stop offset="1" stop-color="#8b2846"/></linearGradient></defs>
            <path d="M32 6c-3 0-6 2-8 5-6 0-11 5-11 11 0 5 4 10 10 11 0 6 8 10 8 10s8-4 8-10c6-1 10-6 10-11 0-6-5-11-11-11-2-3-4-5-7-5z" fill="url(#rg1)"></path>
          </svg>

          <svg class="rose-spot" viewBox="0 0 64 64" data-quote="You laughed and I learned how to stay." role="button" tabindex="0" aria-label="Rose memory 2">
            <use href="#roseSVG" />
          </svg>

          <svg class="rose-spot" viewBox="0 0 64 64" data-quote="Quiet nights with your head on my chest." role="button" tabindex="0" aria-label="Rose memory 3">
            <use href="#roseSVG" />
          </svg>
        </div>
      </div>

      <div class="content">
        <!-- moon easter egg -->
        <div class="moon" id="moon" title="Open the hidden rewards (click)">
          <div class="glow" aria-hidden="true"></div>
          <!-- textured moon SVG: craters + subtle noise illusion -->
          <svg class="svg-wrap" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <radialGradient id="mgrad" cx="35%" cy="30%">
                <stop offset="0" stop-color="#fff9e8" stop-opacity="1"/>
                <stop offset="0.35" stop-color="#ffe6d7" stop-opacity="0.9"/>
                <stop offset="1" stop-color="#caa8a8" stop-opacity="0.95"/>
              </radialGradient>
              <filter id="grain"><feTurbulence baseFrequency="0.8" numOctaves="1" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/><feBlend mode="overlay"/></filter>
            </defs>
            <circle cx="50" cy="50" r="44" fill="url(#mgrad)"/>
            <!-- craters -->
            <g fill="#d6c4c4" opacity="0.18">
              <ellipse cx="62" cy="36" rx="6" ry="4"/>
              <ellipse cx="40" cy="60" rx="9" ry="6"/>
              <ellipse cx="30" cy="30" rx="4" ry="3"/>
            </g>
            <!-- faint internal texture -->
            <circle cx="50" cy="50" r="44" fill="transparent" filter="url(#grain)" opacity="0.06"/>
          </svg>
        </div>

        <div style="position:relative">
          <h3 class="title">For Chandu</h3>
          <div class="subtitle">A kept place — dark, calm, and yours</div>
        </div>

        <div class="letter" id="letter" aria-live="polite">
          <!-- paragraphs are the lines that will be revealed via JS typing -->
          <p data-text="You found the door. Few do. This is a place I built when the world was too bright — a pocket to hold a softer dark, and your name at its center."></p>
          <p data-text="I kept the quiet things here: the scratches of your laugh, the way your breath changed the room, the small chances you gave me without knowing."></p>
          <p data-text="I don't promise forever like it is a calendar — I promise the next small thing. I promise to return when you are needed. A thousand tiny mornings that belong to you."></p>
          <p data-text="If daylight ever makes you loud and busy, come back. Close your eyes and remember: my hands won't let go."></p>
        </div>

      </div>
    </div>
  </div>

  <!-- secret modal used if you want to show extra content without redirect (keeps rewards flexible) -->
  <div class="secret-modal" id="secretModal" aria-hidden="true">
    <div class="secret-inner" role="dialog" aria-modal="true" aria-labelledby="secretTitle">
      <h2 id="secretTitle">Rewards & Secrets</h2>
      <p id="secretText" style="margin-top:10px;color:#f7e8ec">You unlocked the reward portal. This should open the rewards page or reveal your gift tiles.</p>
      <div style="margin-top:14px;display:flex;gap:10px;justify-content:center">
        <button id="goRewards" class="audio-btn" style="background:#fff;color:#000;font-weight:700">Open Rewards</button>
        <button id="closeSecret" class="audio-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- small cursor glow -->
  <div class="cursor" id="cursor" aria-hidden="true"></div>

  <!-- optional ambient audio (replace path if you want) -->
  <audio id="bgAudio" loop preload="none" src="media/secret/ambient.mp3"></audio>

<!-- tiny inline svg symbol for reuse -->
<svg style="display:none"><symbol id="roseSVG" viewBox="0 0 64 64"><path d="M32 6c-3 0-6 2-8 5-6 0-11 5-11 11 0 5 4 10 10 11 0 6 8 10 8 10s8-4 8-10c6-1 10-6 10-11 0-6-5-11-11-11-2-3-4-5-7-5z" fill="#c94f7c"/></symbol></svg>

<script>
/* ============================
 Performance-conscious JS
  - optimized petals via CSS animation with randomization
  - efficient requestAnimationFrame typewriter (per-paragraph)
  - moon click -> reveal modal -> go to rewards (or redirect)
  - lightweight cursor
============================= */

document.addEventListener('DOMContentLoaded', () => {
  const letterEl = document.getElementById('letter');
  const paragraphs = Array.from(letterEl.querySelectorAll('p')).map(p => ({el:p, text:p.dataset.text||''}));

  // TYPEWRITER: reveal paragraphs sequentially with requestAnimationFrame at controlled speed
  (function revealParagraphs(){
    let pIndex = 0;

    function typeParagraph(index){
      if(index >= paragraphs.length) return;
      const item = paragraphs[index];
      const target = item.el;
      const full = item.text;
      target.textContent = '';
      target.style.opacity = '1';
      const len = full.length;
      let i = 0;
      // target speed: characters per second (tweakable)
      const cps = 55 - index*6; // slightly slower later
      const interval = 1000 / cps;
      let previous = performance.now();

      function step(now){
        const delta = now - previous;
        if(delta >= interval){
          previous = now;
          target.textContent += full.charAt(i++);
          if(i >= len){
            // finish paragraph
            target.classList.add('visible');
            // small pause then next paragraph
            setTimeout(()=> typeParagraph(index+1), 380);
            return;
          }
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }
    // kickoff with a small delay to let the page settle
    setTimeout(()=> typeParagraph(0), 700);
  })();

  /* PETALS: create a small number (12) with CSS animation, randomized parameters - cheap */
  (function spawnPetals(){
    const wrap = document.getElementById('petalWrap');
    const count = 12;
    for(let i=0;i<count;i++){
      const d = document.createElement('div');
      d.className = 'petal';
      // random start left between -5% and 105%
      const sx = Math.random()*110 - 5;
      // random destination X offset
      const dx = (Math.random()*160 - 80);
      d.style.setProperty('--sx', sx + 'vw');
      d.style.setProperty('--dx', dx + 'px');
      d.style.left = sx + 'vw';
      d.style.top = (-5 - Math.random()*8) + 'vh';
      const size = 8 + Math.floor(Math.random()*18);
      d.style.width = size+'px';
      d.style.height = (size*1.4)+'px';
      d.style.opacity = (0.45 + Math.random()*0.6).toFixed(2);
      const dur = 4500 + Math.random()*7000;
      d.style.animation = `fallA ${dur}ms linear ${Math.random()*2000}ms forwards`;
      wrap.appendChild(d);
      // remove when animation ends
      (function(el){
        el.addEventListener('animationend', ()=> el.remove());
        // schedule respawn occasionally
        setTimeout(()=> {
          if(Math.random() < 0.7){ // spawn another
            const clone = el.cloneNode();
            clone.style.left = (Math.random()*110 - 5) + 'vw';
            clone.style.top = (-8 - Math.random()*6) + 'vh';
            clone.style.animation = `fallA ${4500 + Math.random()*7000}ms linear ${Math.random()*2000}ms forwards`;
            wrap.appendChild(clone);
            clone.addEventListener('animationend', ()=> clone.remove());
          }
        }, 2400 + Math.random()*4000);
      })(d);
    }
  })();

  /* Moon Easter-egg - improved interaction:
     - click -> gentle scale + overlay; open rewards modal (or redirect)
     - visually pleasing, low-cost transforms
  */
  const moon = document.getElementById('moon');
  const secretModal = document.getElementById('secretModal');
  const goRewards = document.getElementById('goRewards');
  const closeSecret = document.getElementById('closeSecret');
  const bgAudio = document.getElementById('bgAudio');
  const audioToggle = document.querySelector('.audio-btn');

  // click handler: animate moon then show modal
  moon.addEventListener('click', clickMoon);
  moon.addEventListener('keydown', (e)=> { if(e.key === 'Enter') clickMoon(); });

  function clickMoon(){
    // small kinetic animation
    moon.animate([{transform:'scale(1)'},{transform:'scale(1.18)'},{transform:'scale(1)'}], {duration:540, easing:'cubic-bezier(.2,.9,.2,1)'});
    // show secret modal after slight delay
    setTimeout(() => {
      secretModal.classList.add('show');
      secretModal.setAttribute('aria-hidden','false');
    }, 260);
  }

  // rewards action: either redirect to rewards page or you can replace with inline reveal
  // CHANGE THIS to your actual reward page URL if you prefer a separate page:
  goRewards.addEventListener('click', () => {
    // smooth overlay then redirect
    const overlay = document.createElement('div');
    overlay.style.position='fixed'; overlay.style.inset=0; overlay.style.background='rgba(8,6,6,0.9)'; overlay.style.zIndex=9999;
    overlay.style.opacity='0'; overlay.style.transition='opacity .45s ease';
    document.body.appendChild(overlay);
    requestAnimationFrame(()=> overlay.style.opacity='1');
    // redirect after short delay
    setTimeout(()=> { window.location.href = 'reward.html'; }, 600);
  });

  closeSecret.addEventListener('click', ()=> {
    secretModal.classList.remove('show');
    secretModal.setAttribute('aria-hidden','true');
  });
  secretModal.addEventListener('click', (e)=> { if(e.target===secretModal) { closeSecret.click(); } });

  // simple tooltip on rose-spot clicks to show quick modal quote (cheap)
  document.querySelectorAll('.rose-spot').forEach(spot => {
    spot.addEventListener('click', () => {
      const q = spot.getAttribute('data-quote') || "A memory.";
      const secretText = document.getElementById('secretText');
      secretText.textContent = q;
      secretModal.classList.add('show');
      secretModal.setAttribute('aria-hidden','false');
    });
    spot.addEventListener('keypress', (e)=> { if(e.key==='Enter') spot.click(); });
  });

  // custom cursor update (cheap)
  const cursor = document.getElementById('cursor');
  document.body.classList.add('custom-cursor'); // to hide native cursor via CSS if desired
  document.addEventListener('mousemove', e => {
    cursor.style.left = e.clientX + 'px';
    cursor.style.top  = e.clientY + 'px';
  });

  // audio toggle
  audioToggle.addEventListener('click', () => {
    if(bgAudio.paused){
      bgAudio.play().catch(()=>{/* autoplay blocked */});
      audioToggle.textContent = '🔊 Ambience on';
    } else {
      bgAudio.pause();
      audioToggle.textContent = 'Play ambience';
    }
  });

  // accessibility: Esc closes modal
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape') { closeSecret.click(); }
  });
}); // DOMContentLoaded
</script>
</body>
</html>